<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Modern Score Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --glass:rgba(255,255,255,.15);
  --blur:blur(15px);
  --white:#fff;
  --accent:#0d6efd;
  --green:#20c997;
  --red:#ff6b6b;
}
*{box-sizing:border-box;font-family:"Segoe UI",sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#0d6efd,#6610f2);
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
}
#app{
  width:95%;
  max-width:430px;
}
.glass{
  background:var(--glass);
  backdrop-filter:var(--blur);
  border-radius:20px;
  padding:20px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
  animation:fade .5s ease;
}
@keyframes fade{
  from{opacity:0;transform:translateY(15px)}
  to{opacity:1}
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:var(--accent);
  color:white;
  font-size:16px;
  margin-top:12px;
  cursor:pointer;
}
.back{background:#6c757d}
.toggle{background:#212529}

.card{
  background:rgba(255,255,255,.9);
  color:#000;
  border-radius:18px;
  padding:18px;
  margin-top:15px;
  text-align:center;
}
.score{
  font-size:50px;
  font-weight:bold;
  transition:.3s;
}
.controls button{
  width:60px;
  height:60px;
  border-radius:50%;
  font-size:26px;
  margin:6px;
}
.plus{background:var(--green)}
.minus{background:var(--red)}

.history{
  text-align:left;
  font-size:14px;
  max-height:150px;
  overflow:auto;
  margin-top:10px;
}
.hist{
  display:flex;
  justify-content:space-between;
}
.edit{color:#0d6efd;cursor:pointer}
.del{color:red;cursor:pointer}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#000;
  color:white;
  padding:12px 20px;
  border-radius:20px;
  opacity:0;
  pointer-events:none;
  transition:.4s;
}
.toast.show{opacity:1;bottom:35px}
</style>
</head>

<body>

<div id="app" class="glass">
  <h2 style="text-align:center">Select Mode</h2>
  <button onclick="login('ERON')">ERON</button>
  <button onclick="login('LAWIN')">LAWIN</button>
  <button onclick="guest()">üëÄ Guest View</button>
</div>

<div class="toast" id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCfVDdwgkMkhdd-1TIQJbd3M_UWvNZQw8k",
  authDomain:"score-dashboard-304f0.firebaseapp.com",
  projectId:"score-dashboard-304f0"
});
const db=firebase.firestore();

const PASS={ERON:"0022",LAWIN:"0023"};
const ADMIN="9999";
let role="";
let scores={ERON:0,LAWIN:0};
let history={ERON:[],LAWIN:[]};
let chart;

/* UTIL */
function toast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}
function now(){
  return new Date().toLocaleString();
}

/* LOGIN */
function login(u){
  const p=prompt("Password:");
  if(p===ADMIN){role="ADMIN";dashboard("ADMIN");return;}
  if(p!==PASS[u])return alert("Wrong");
  role=u;
  dashboard(u);
}
function guest(){
  role="GUEST";
  dashboard("GUEST VIEW");
}

/* DASHBOARD */
function dashboard(title){
  document.getElementById("app").innerHTML=`
  <h2 style="text-align:center">${title}</h2>
  <canvas id="chart" height="120"></canvas>
  ${card("ERON")}
  ${card("LAWIN")}
  <button class="back" onclick="location.reload()">‚¨Ö Back</button>`;
  load();
}

/* CARD */
function card(u){
  return`
  <div class="card">
    <h3>${u}</h3>
    <div class="score" id="s-${u}">0</div>
    ${(role===u||role==="ADMIN")?`
    <div class="controls">
      <button class="plus" onclick="change('${u}',1)">+</button>
      <button class="minus" onclick="change('${u}',-1)">-</button>
    </div>`:""}
    <div class="history" id="h-${u}"></div>
  </div>`;
}

/* DATA */
function load(){
  ["ERON","LAWIN"].forEach(u=>{
    db.collection("scores").doc(u).get().then(d=>{
      if(d.exists){
        scores[u]=d.data().value||0;
        history[u]=d.data().history||[];
      }
      update(u);
    });
  });
  setTimeout(draw,300);
}
function save(u){
  db.collection("scores").doc(u).set({
    value:scores[u],
    history:history[u]
  });
}

/* SCORE */
function change(u,v){
  scores[u]+=v;
  if(scores[u]<0)scores[u]=0;
  history[u].push({v:scores[u],t:now()});
  save(u);
  update(u);
  updateChart();
  toast((v>0?"+":"-")+"1 for "+u);
}

/* UI */
function update(u){
  document.getElementById("s-"+u).innerText=scores[u];
  document.getElementById("h-"+u).innerHTML=
    history[u].map((x,i)=>`
    <div class="hist">
      <span>${x.v} ‚Äî ${x.t}</span>
      ${role==="ADMIN"?`
      <span>
        <span class="edit" onclick="edit('${u}',${i})">‚úè</span>
        <span class="del" onclick="del('${u}',${i})">‚úñ</span>
      </span>`:""}
    </div>`).join("");
}
function edit(u,i){
  const t=prompt("Edit time",history[u][i].t);
  if(!t)return;
  history[u][i].t=t;
  save(u);update(u);
}
function del(u,i){
  history[u].splice(i,1);
  scores[u]=history[u].length?history[u][history[u].length-1].v:0;
  save(u);update(u);updateChart();
  toast("Deleted");
}

/* CHART */
function draw(){
  const ctx=document.getElementById("chart");
  chart=new Chart(ctx,{
    type:"bar",
    data:{
      labels:["ERON","LAWIN"],
      datasets:[{
        data:[scores.ERON,scores.LAWIN],
        backgroundColor:["#20c997","#ff6b6b"]
      }]
    },
    options:{plugins:{legend:{display:false}}}
  });
}
function updateChart(){
  chart.data.datasets[0].data=[scores.ERON,scores.LAWIN];
  chart.update();
}
</script>

</body>
</html>
