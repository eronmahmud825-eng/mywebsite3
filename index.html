<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Score Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0b1020;
  --card:#131a33;
  --glass:rgba(255,255,255,.08);
  --blue:#4f7cff;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

*{box-sizing:border-box;font-family:Inter,system-ui}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at top,var(--blue),transparent 40%),
    var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
}

/* LOGIN */
.login{
  width:92%;
  max-width:420px;
  background:var(--card);
  border-radius:22px;
  padding:28px;
  box-shadow:0 30px 80px rgba(0,0,0,.6);
}

.login h2{
  margin-bottom:20px;
  text-align:center;
}

button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border:none;
  border-radius:14px;
  font-size:15px;
  background:var(--blue);
  color:white;
  cursor:pointer;
  transition:.25s;
}

button:hover{transform:translateY(-2px);opacity:.9}
.back{background:#374151}
.toggle{background:#111827}

/* DASHBOARD */
.dashboard{
  width:100%;
  max-width:520px;
  padding:16px;
}

.dashboard h2{
  text-align:center;
  margin-bottom:10px;
}

.card{
  background:var(--card);
  border-radius:20px;
  padding:18px;
  margin-bottom:16px;
  box-shadow:0 20px 50px rgba(0,0,0,.5);
}

/* SCORE CARD */
.user{
  text-align:center;
}

.score{
  font-size:60px;
  font-weight:800;
  margin:6px 0;
}

.controls{
  display:flex;
  justify-content:center;
  gap:20px;
}

.controls button{
  width:64px;
  height:64px;
  font-size:30px;
  border-radius:50%;
}

.plus{background:var(--green)}
.minus{background:var(--red)}

/* HISTORY */
.history{
  margin-top:12px;
  max-height:160px;
  overflow:auto;
  font-size:14px;
}

.hist{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  border-bottom:1px solid rgba(255,255,255,.06);
}

.edit{color:#60a5fa;cursor:pointer;margin-right:8px}
.del{color:#f87171;cursor:pointer}

/* CHART */
canvas{margin-top:10px}
</style>
</head>

<body>

<div class="login" id="app">
  <h2>Select Mode</h2>
  <button onclick="selectUser('ERON')">ERON</button>
  <button onclick="selectUser('LAWIN')">LAWIN</button>
  <button onclick="openGuest()">üëÄ Guest</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCfVDdwgkMkhdd-1TIQJbd3M_UWvNZQw8k",
  authDomain:"score-dashboard-304f0.firebaseapp.com",
  projectId:"score-dashboard-304f0"
});
const db=firebase.firestore();

const passwords={ERON:"0022",LAWIN:"0023"};
const ADMIN_PASSWORD="9999";

let currentUser="";
let scores={ERON:0,LAWIN:0};
let histories={ERON:[],LAWIN:[]};
let historyEnabled=true;
let chart;

function now(){return new Date().toLocaleString();}

/* LOGIN */
function selectUser(user){
  const p=prompt("Password:");
  if(p===ADMIN_PASSWORD){openAdmin();return;}
  if(p!==passwords[user]){alert("Wrong password");return;}
  openDash(user);
}
function openGuest(){currentUser="GUEST";render("Guest View",false)}
function openDash(u){currentUser=u;render(u+" Dashboard",false)}
function openAdmin(){currentUser="ADMIN";render("Admin Dashboard",true)}

/* RENDER */
function render(title,isAdmin){
  document.getElementById("app").outerHTML=`
  <div class="dashboard">
    <h2>${title}</h2>

    <div class="card">
      ${isAdmin?`<button class="toggle" onclick="toggleHistory()">History ${historyEnabled?"ON":"OFF"}</button>`:""}
      <canvas id="scoreChart" height="120"></canvas>
    </div>

    ${userCard("ERON")}
    ${userCard("LAWIN")}

    <button class="back" onclick="location.reload()">‚¨Ö Back</button>
  </div>`;
  load();
}

/* CARDS */
function userCard(u){
  return`
  <div class="card user">
    <h3>${u}</h3>
    <div class="score" id="score-${u}">0</div>

    ${(currentUser===u||currentUser==="ADMIN")?`
    <div class="controls">
      <button class="plus" onclick="change('${u}',1)">+</button>
      <button class="minus" onclick="change('${u}',-1)">-</button>
    </div>`:""}

    <div class="history" id="history-${u}"></div>
  </div>`;
}

/* DATA */
function load(){
  ["ERON","LAWIN"].forEach(u=>{
    db.collection("scores").doc(u).get().then(d=>{
      if(d.exists){
        scores[u]=d.data().value||0;
        histories[u]=d.data().history||[];
      }else db.collection("scores").doc(u).set({value:0,history:[]});
      update(u);
    });
  });
  setTimeout(draw,300);
}

function change(u,v){
  if(currentUser!==u&&currentUser!=="ADMIN")return;
  if(v===1){scores[u]++;if(historyEnabled)histories[u].push({v:scores[u],t:now()});}
  if(v===-1&&scores[u]>0){scores[u]--;if(historyEnabled)histories[u].pop();}
  save(u);
}

function save(u){
  db.collection("scores").doc(u).set({value:scores[u],history:histories[u]});
  update(u);updateChart();
}

function update(u){
  document.getElementById("score-"+u).innerText=scores[u];
  document.getElementById("history-"+u).innerHTML=
    histories[u].map((h,i)=>`
    <div class="hist">
      <span>${h.v} ‚Äî ${h.t}</span>
      ${currentUser==="ADMIN"?`
      <span>
        <span class="edit" onclick="edit('${u}',${i})">‚úè</span>
        <span class="del" onclick="del('${u}',${i})">‚úñ</span>
      </span>`:""}
    </div>`).join("");
}

function edit(u,i){
  const t=prompt("Edit time:",histories[u][i].t);
  if(!t)return;histories[u][i].t=t;save(u);
}
function del(u,i){
  histories[u].splice(i,1);
  scores[u]=histories[u].length?histories[u].at(-1).v:0;
  save(u);
}
function toggleHistory(){historyEnabled=!historyEnabled;openAdmin()}

/* CHART */
function draw(){
  const c=document.getElementById("scoreChart").getContext("2d");
  chart=new Chart(c,{
    type:"bar",
    data:{
      labels:["ERON","LAWIN"],
      datasets:[{data:[scores.ERON,scores.LAWIN],backgroundColor:["#22c55e","#ef4444"]}]
    },
    options:{plugins:{legend:{display:false}}}
  });
}
function updateChart(){
  chart.data.datasets[0].data=[scores.ERON,scores.LAWIN];
  chart.update();
}
</script>

</body>
</html>


</body>
</html>

