<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Score Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;font-family:"Segoe UI",sans-serif}
body{
  margin:0;
  background:linear-gradient(135deg,#0d6efd,#6610f2);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-container{
  background:white;
  width:90%;
  max-width:380px;
  padding:25px;
  border-radius:15px;
  text-align:center;
}
button{
  width:100%;
  padding:14px;
  margin-top:12px;
  font-size:16px;
  border:none;
  border-radius:10px;
  background:#0d6efd;
  color:white;
  cursor:pointer;
}
.toggle{background:#212529}
.back{background:#6c757d}
.dashboard{width:100%;padding:15px}
.dashboard h2{color:white;text-align:center}
.user-card{
  background:white;
  border-radius:15px;
  padding:20px;
  margin-bottom:15px;
  text-align:center;
}
.score{font-size:48px;font-weight:bold}
.controls button{
  width:60px;height:60px;font-size:28px;margin:5px;border-radius:50%
}
.plus{background:#198754}
.minus{background:#dc3545}
.history{font-size:14px;margin-top:10px;text-align:left}
.hist-item{display:flex;justify-content:space-between;align-items:center}
.edit{color:#0d6efd;cursor:pointer;margin-left:6px}
.del{color:red;cursor:pointer;margin-left:6px}
</style>
</head>

<body>

<div class="login-container" id="app">
  <h2>Select Mode</h2>
  <button onclick="selectUser('ERON')">ERON</button>
  <button onclick="selectUser('LAWIN')">LAWIN</button>
  <button onclick="openGuest()">üëÄ GUEST</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCfVDdwgkMkhdd-1TIQJbd3M_UWvNZQw8k",
  authDomain:"score-dashboard-304f0.firebaseapp.com",
  projectId:"score-dashboard-304f0"
});
const db=firebase.firestore();

const passwords={ERON:"0022",LAWIN:"0023"};
const ADMIN_PASSWORD="9999";

let currentUser="";
let scores={ERON:0,LAWIN:0};
let histories={ERON:[],LAWIN:[]};
let historyEnabled=true;
let chart=null;

function now(){
  return new Date().toLocaleString();
}

function home(){
  location.reload();
}

function selectUser(user){
  const pass=prompt(`Enter password for ${user}`);
  if(pass===ADMIN_PASSWORD) return openAdmin();
  if(pass!==passwords[user]) return alert("Wrong password");
  openDashboard(user);
}

function openGuest(){render("üëÄ GUEST VIEW",false,"GUEST")}
function openDashboard(u){render(`${u} Dashboard`,false,u)}
function openAdmin(){render("üëë ADMIN DASHBOARD",true,"ADMIN")}

function render(title,isAdmin,user){
  currentUser=user;
  document.getElementById("app").innerHTML=`
  <div class="dashboard">
    <h2>${title}</h2>

    ${isAdmin?`
    <button class="toggle" onclick="toggleHistory()">
      History: ${historyEnabled?"ON ‚úÖ":"OFF ‚ùå"}
    </button>`:""}

    <canvas id="scoreChart" height="120"></canvas>
    ${card("ERON")}
    ${card("LAWIN")}
    <button class="back" onclick="home()">üè† Back Home</button>
  </div>`;
  loadData();
}

function card(name){
  return `
  <div class="user-card">
    <h3>${name}</h3>
    <div class="score" id="score-${name}">0</div>

    ${(currentUser===name||currentUser==="ADMIN")?`
    <div class="controls">
      <button class="plus" onclick="changeScore('${name}',1)">+</button>
      <button class="minus" onclick="changeScore('${name}',-1)">-</button>
    </div>`:""}

    <div class="history" id="history-${name}"></div>
  </div>`;
}

function loadData(){
  Promise.all([
    db.collection("settings").doc("history").get(),
    ...["ERON","LAWIN"].map(u=>db.collection("scores").doc(u).get())
  ]).then(res=>{
    if(res[0].exists) historyEnabled=res[0].data().enabled;
    ["ERON","LAWIN"].forEach((u,i)=>{
      const d=res[i+1];
      if(d.exists){
        scores[u]=d.data().value||0;
        histories[u]=d.data().history||[];
      }
      updateUI(u);
    });
    drawChart();
  });
}

function toggleHistory(){
  historyEnabled=!historyEnabled;
  db.collection("settings").doc("history").set({enabled:historyEnabled});
  openAdmin();
}

function changeScore(user,val){
  if(currentUser!==user && currentUser!=="ADMIN") return;

  if(val===1){
    scores[user]++;
    if(historyEnabled || currentUser!=="ADMIN")
      histories[user].push({v:scores[user],t:now()});
  }
  if(val===-1 && scores[user]>0){
    scores[user]--;
    if(historyEnabled || currentUser!=="ADMIN")
      histories[user].pop();
  }
  save(user);
}

function editTime(user,i){
  const t=prompt("Edit time:",histories[user][i].t);
  if(t){histories[user][i].t=t;save(user);}
}

function deleteHistory(user,i){
  histories[user].splice(i,1);
  scores[user]=histories[user].length;
  save(user);
}

function save(user){
  db.collection("scores").doc(user).set({
    value:scores[user],
    history:histories[user]
  });
  updateUI(user);
  updateChart();
}

function updateUI(user){
  document.getElementById(`score-${user}`).innerText=scores[user];
  document.getElementById(`history-${user}`).innerHTML=
    "<b>History</b><br>"+histories[user].map((h,i)=>`
    <div class="hist-item">
      <span>${h.v} ‚Äî ${h.t}</span>
      ${currentUser==="ADMIN"?`
      <span>
        <span class="edit" onclick="editTime('${user}',${i})">üïí</span>
        <span class="del" onclick="deleteHistory('${user}',${i})">‚úñ</span>
      </span>`:""}
    </div>`).join("");
}

function drawChart(){
  const ctx=document.getElementById("scoreChart").getContext("2d");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:"bar",
    data:{
      labels:["ERON","LAWIN"],
      datasets:[{
        data:[scores.ERON,scores.LAWIN],
        backgroundColor:["#198754","#dc3545"]
      }]
    },
    options:{plugins:{legend:{display:false}}}
  });
}

function updateChart(){
  chart.data.datasets[0].data=[scores.ERON,scores.LAWIN];
  chart.update();
}
</script>

</body>
</html>


